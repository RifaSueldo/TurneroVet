<!DOCTYPE html>
<html lang="es">
<head>
   <meta charset="UTF-8" />
  <title>TurnoX - Turnos On Line</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" integrity="sha512-..." crossorigin="anonymous" referrerpolicy="no-referrer" />
<link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;500;700&display=swap" rel="stylesheet">
<link href="https://fonts.googleapis.com/css2?family=Fredoka:wght@300..700&display=swap" rel="stylesheet">
  <link rel="icon" href="https://i.ibb.co/p6Ycq6XC/Turnox-logo.png" href="favicon.png">
<!-- O para .ico -->
<!-- Flatpickr JS y locales -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">

   
<!-- Tema moderno -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/themes/material_blue.css">
<!-- Open Graph para redes sociales como Facebook, WhatsApp -->
<meta property="og:title" content="TurnoX - Turnos On Line" />
<meta property="og:description" content="Solicit√° tu turno on line y descargalo con un ID sin cargo" />
<meta property="og:image" content="https://i.ibb.co/p6Ycq6XC/Turnox-logo.png" />
<meta property="og:url" content="https://turnox.netlify.app/" />
<meta property="og:type" content="website" />

<!-- Twitter Card -->
<meta name="twitter:card" content="summary_large_image" />
<meta name="twitter:title" content="TurnoX - Turnos On Line" />
<meta name="twitter:description" content="Solicit√° tu turno on line y descargalo con un ID sin cargo." />
<meta name="twitter:image" content="https://i.ibb.co/p6Ycq6XC/Turnox-logo.png" />
  
  <style>
html {
  scroll-behavior: smooth;
}
    /* ======== ESTILOS GENERALES ======== */
    body {
      font-family: "Montserrat", sans-serif;
  font-optical-sizing: auto;
  font-weight: <weight>;
  font-style: normal;
      background: #f8f8f8;
  color: #533482;
      margin: 0;
      padding: 0;
      
      font-size: 14px;
    }

    header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  background:  #533482;
  color: white;
  padding: 10px 20px;
  position: sticky;
  top: 0;
  z-index: 999;
  box-shadow: 0 2px 6px rgba(0,0,0,0.15);
  backdrop-filter: blur(6px);
}
#tooltip { display:none; position:absolute; ... }
#tooltip.visible { display:block; }
#creditosTooltip.show { display:block; }

#inputBusquedaGeneral {
  background-color: #fff !important; /* color por defecto */
}

#inputBusquedaGeneral:focus {
  background-color: ##EDEDED !important; /* color cuando est√° enfocado */
}
     #inputBusquedaGeneral:not(:placeholder-shown) {
  background-color: #EDEDED !important; /* por ejemplo, verde suave */
}
    .container {
      margin: 20px auto;
      max-width: 900px;
      background: #fff;
      padding: 20px;
      border-radius: 10px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.08);
    }

    /* ======== LOGIN MODERNO CENTRADO ======== */
    #loginDiv {
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      max-width: 350px;
      width: 90%;
      background: #fff;
      padding: 25px 20px;
      border-radius: 12px;
      box-shadow: 0 6px 18px rgba(0, 0, 0, 0.15);
      text-align: center;
      z-index: 1000;
    }

    #loginDiv h2 {
      margin-bottom: 15px;
      color: #533482;
      font-size: 20px;
    }

    #loginDiv input[type="text"],
    #loginDiv input[type="password"] {
      width: 80%;
      padding: 10px;
      margin: 8px 0;
      border: 1px solid #EDEDED;
      border-radius: 6px;
      font-size: 14px;
      background: #fdfdfd;
      transition: border 0.2s;
      font-family: "Montserrat", sans-serif;
  font-optical-sizing: auto;
  font-weight: <weight>;
  font-style: normal;
    }

    #loginDiv input:focus {
      border-color: #533482;
      outline: none;
    }

    #loginDiv button {
      width: 100%;
      background: #533482;
      color: #fff;
      border: none;
      padding: 12px;
      font-size: 14px;
      border-radius: 6px;
      cursor: pointer;
      transition: background 0.2s;
      margin-top: 10px;
    }

    #loginDiv button:hover {
      background: #6B6870;
    }

    #errorLogin {
      color: red;
      font-size: 14px;
      margin-top: 6px;
      display: none;
    }

    /* ======== INPUTS Y BOTONES ======== */
    input[type="text"], input[type="email"], textarea, select, input[type="date"] {
      width: 80%;
      padding: 8px;
      margin: 4px 0 10px;
      border: 1px solid #EDEDED;
      border-radius: 6px;
      font-size: 14px;
      background: #fff;
      transition: border-color 0.2s;
      text-align: center;
    }

    input:focus, textarea:focus, select:focus {
      border-color:#533482;
      outline: none;
    }

    button {
      background: #533482;
      color: white;
      border: none;
      padding: 8px 14px;
      border-radius: 6px;
      font-size: 14px;
      cursor: pointer;
      margin: 6px 2px;
      transition: background 0.3s;
    }

    button:hover {
      background: #6B6870;
    }

    /* ======== RESULTADOS (FICHA M√âDICA) ======== */
    /* Centrar resultados y reducir espacio */
    .resultado {
      padding: 15px;
      margin-bottom: 15px;
      border-radius: 6px;
      background-color: white;
      box-shadow: 0 0 5px rgba(0,0,0,0.1);
      text-align: left;
    }

    .resultado.alternado {
      background-color: #f0f0f0;
    }

    .resultado label {
      font-size: 14px;
      margin-bottom: 1px;
      display: block;
      font-weight: bold;
    }

    .resultado input,
    .resultado textarea,
    .resultado select {
      font-size: 14px;
      padding: 6px;
      margin-bottom: 6px;
      width: 100%;
      box-sizing: border-box;
    }

    .resultado textarea {
      min-height: 40px;
    }

    .resultado .acciones {
      margin-top: 6px;
    }

    .resultado button {
      padding: 6px 10px;
      font-size: 14px;
    }

    /* Extra campos din√°micos */
    .campo-extra {
      margin-bottom: 10px;
      position: relative;
    }
    .campo-extra button {
      position: absolute;
      top: 30px;
      right: 0;
      background: #e74c3c;
      padding: 2px 8px;
      font-size: 14px;
      border-radius: 4px;
      margin-left: 5px;
    }

    /* ======== OTROS ======== */
    #cargando {
      display: none;
      margin-top: 8px;
      font-size: 14px;
      color: #666;
      text-align: center;
    }

    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(5px); }
      to { opacity: 1; transform: translateY(0); }
    }

    /* Responsive m√≥vil */
    @media (max-width: 768px) {
      .resultado-grid {
        grid-template-columns: 1fr;
      }
    }

    /* Modal nuevo campo */
    #modalCampo {
      display: none;
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background:#fff;
      padding: 20px;
      border-radius: 10px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.3);
      z-index: 2000;
      width: 300px;
    }
    #modalCampo label {
      font-weight: bold;
      margin-top: 10px;
      display: block;
    }
    #modalCampo input[type=text], #modalCampo select {
      margin-top: 5px;
    }

    /* NUEVO: Contenedor para b√∫squeda por fecha */
    #busquedaFecha {
     display: flex;
  flex-direction: column; /* para mantener label + calendario vertical */
  align-items: center;    /* centra horizontalmente todo */
  margin: 20px auto;
    }
    .bloque-campos {
  border-top: 1px dotted #000000;
  margin-top: 10px;
  padding-top: 10px;
}
 
    .btn-redireccion {
  display: inline-block;
  background-color: #6B6870;
  color: white;
  padding: 8px 15px;
  border-radius: 5px;
  text-decoration: none;
  font-size: 14px;
  transition: background 0.3s ease;
}

.btn-redireccion:hover {
  background-color: #533482;
}

  .mensaje-bienvenida {
  background-color: #533482;  
  color: white;
  font-weight: 600;
  padding: 12px 20px;
  
  margin-bottom: 1rem;
  font-size: 1.1rem;
  text-align: left;
  box-shadow: 0 2px 6px rgba(196, 38, 133, 0.4);
  user-select: none;
}

/* Navbar principal */
.navbar {
  display: flex;
  justify-content: space-between;
  align-items: center;
  background: rgba(54, 42, 111, 0.9);
  color: white;
  padding: 10px 20px;
  position: sticky;
  top: 0;
  z-index: 999;
  box-shadow: 0 2px 6px rgba(0,0,0,0.15);
  backdrop-filter: blur(6px);
}

/* Logo con animaci√≥n */
.navbar-logo img {
  width: 90px;
  opacity: 0;
  transform: translateX(100px);
  animation: slideInRight 1.2s cubic-bezier(0.25, 1, 0.5, 0.2) forwards,
             saltitoSutil 6s ease-in-out 1.2s infinite;
}

@keyframes slideInRight {
  0% {
    transform: translateX(100px);
    opacity: 0;
  }
  80% {
    transform: translateX(-10px);
    opacity: 1;
  }
  100% {
    transform: translateX(0);
    opacity: 1;
  }
}

@keyframes saltitoSutil {
  0%, 80%, 100% { transform: translateY(0); }
  85% { transform: translateY(-4px); }
  90% { transform: translateY(0); }
}

/* Men√∫ de navegaci√≥n */
.navbar-menu {
  display: flex;
  gap: 20px;
  transition: max-height 0.3s ease-out;
}

/* Enlaces del men√∫ */
.navbar-menu .nav-link {
  color: white;
  text-decoration: none;
  font-weight: 600;
  font-size: 16px;
  padding: 6px 8px;
  border-radius: 4px;
  transition: background-color 0.2s ease;
}
.navbar-menu .nav-link:hover {
  background-color: #533482;
}

/* Bot√≥n hamburguesa - oculto por defecto */
.navbar-toggle {
  display: none;
  background: none;
  border: none;
  color: white;
  font-size: 24px;
  cursor: pointer;
  transition: transform 0.3s ease;
}

/* Estado activo - √≠cono X */
.navbar-toggle.active i {
  transform: rotate(90deg);
}
.navbar-toggle.active i::before {
  content: "\f00d"; /* √çcono X (Font Awesome) */
}

/* Modo m√≥vil */
@media (max-width: 768px) {
  .navbar-menu {
    display: flex;
    flex-direction: column;
    position: absolute;
    top: 85px;
    right: 2px;
    background: rgba(54, 42, 111, 0.95);
    border-radius: 8px;
    box-shadow: 0 4px 8px rgba(0,0,0,0.3);
    overflow: hidden;
    max-height: 0;
  }
  .navbar-menu.active {
    max-height: 300px;
    transition: max-height 0.4s ease-in-out;
  }
  .navbar-toggle {
    display: block;
  }
  .navbar-menu .nav-link {
    padding: 10px;
    text-align: center;
  }
}

/* Por defecto ocultar bot√≥n y men√∫ */
#navbarToggle,
#navbarMenu {
  display: none;
}

/* Mostrar bot√≥n hamburguesa s√≥lo en m√≥vil y cuando est√° logueado */
@media (max-width: 768px) {
  body.logueado #navbarToggle {
    display: flex;
  }
}

/* En PC oculto aunque est√© logueado */
@media (min-width: 769px) {
  body.logueado #navbarToggle {
    display: none !important;
  }
}

body.logueado #navbarMenu {
  display: flex;
  /* Para PC y m√≥viles */
}

/* Control para mostrar men√∫ cuando est√° abierto */
#navbarMenu.open {
  display: flex;
}

  
  
/* Centrar todo en pantalla */
.creditos-container {
  /*position: fixed;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);*/
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 10px;
 
}

/* Bot√≥n */
#creditosBtn {
  background: #EDEDED;
  color: #999;
  border: none;
  padding: 0px 10px;
  border-radius: 6px;
  cursor: pointer;
  font-size: 14px;

   display: inline-flex;           /* Para que est√©n en fila, lado a lado */
  align-items: center;            /* Centra verticalmente */
  gap: 6px;                      /* Espacio entre el icono y el n√∫mero */
  

}

/* Burbuja */
.tooltip {
  background: white;
  border: 1px solid #EDEDED;
  border-radius: 8px;
  padding: 15px;
  box-shadow: 0px 4px 15px rgba(0,0,0,0.2);
  display: none;
  flex-direction: column;
  gap: 10px;
  text-align: center;
}
.tooltip.visible {
  display: flex;
}
.busqueda-container {
  text-align: center;
}

.botones-busqueda {
  display: flex;
  justify-content: center;
  gap: 8px; /* espacio entre botones */
  margin-top: 8px;
  flex-wrap: wrap; /* si no entran, pasan a otra l√≠nea */
}

.botones-busqueda button {
  min-width: 120px;
  height: 40px;
  font-size: 14px;
}
input[type="date"] {
  padding: 8px 12px;
  font-size: 16px;
  border: 2px solid #533482;
  border-radius: 6px;
  background-color: #fff;
  color: #333;
  outline: none;
  transition: all 0.2s ease;
}

input[type="date"]:focus {
  border-color: #7a56b6;
  box-shadow: 0 0 6px rgba(122, 86, 182, 0.5);
}

#fechaTurno {
  display: inline-block; /* permite que se centre con text-align:center en el contenedor */
}

/* Header del calendario */
/* Contenedor principal del calendario */
.flatpickr-day.selected {
  background-color: #533482 !important;
}
.span.flatpickr-weekday {
   
    background-color: #533482 !important;
    
}
     span.flatpickr-weekday {
    
   background-color: #533482 !important;
        color: #fff;
 
}

.flatpickr-weekdays {
   background-color: #533482 !important;

}
 .flatpickr-months .flatpickr-month {
   background-color: #533482 !important;

}

.flatpickr-current-month .flatpickr-monthDropdown-months {
   background-color: #533482 !important;

}

     .flatpickr-current-month .flatpickr-monthDropdown-months {
   background-color: #533482 !important;

}

     /* Fondo del dropdown de meses */
.flatpickr-monthDropdown-months {
    background-color: #533482 !important;
    color: #fff !important;
}

/* Opciones dentro del select de meses */
.flatpickr-monthDropdown-months option {
    background-color: #533482 !important;
    color: #fff !important;
}
.flatpickr-monthDropdown-months option:hover {
    background-color: #7a5bb5 !important;
    color: #fff !important;
}

/* Contenedor de todos los turnos */
#resultadoFecha h3 {
    width: 100%;          /* Ocupa todo el ancho */
    text-align: center;   /* Centrado */
    color: #533482;
    font-family: 'Montserrat', sans-serif;
    margin-bottom: 20px;  /* Espacio con los turnos */
}

#resultadoFecha {
    display: flex;
    flex-wrap: wrap;
    justify-content: center;
    gap: 20px;
    margin-top: 20px;
   font-family: 'Montserrat', sans-serif;
}

/* Tarjeta de turno */
.resultado {
    background: linear-gradient(145deg, #533482, #fff);
    border-radius: 14px;
    box-shadow: 0 6px 15px rgba(0,0,0,0.15);
    padding: 20px;
    width: 290px;
    font-family: 'Montserrat', sans-serif;
    transition: transform 0.2s, box-shadow 0.2s;
    position: relative;
    display: flex;
    flex-direction: column;
    align-items: center; /* centramos contenido dentro de la tarjeta */
}

/* Logo dentro del turno */
.resultado .logo-turno {
    width: 100px;
    height: 60px;
    
   
    object-fit: contain;
    
   
    
}
.logo-container {
    text-align: center; /* centrar logo */
    margin-bottom: 10px; /* separar del resto */
}

.logo-turno {
    width: 50px; /* ajustar tama√±o */
    height: auto;
    display: inline-block;
}

/* Hover elegante */
.resultado:hover {
    transform: translateY(-5px);
    box-shadow: 0 8px 20px rgba(0,0,0,0.25);
}

/* T√≠tulo de cada campo */
.resultado label {
    font-weight: 600;
    color: #533482;
    display: flex;
    align-items: center;
    margin-top: 10px;
    font-size: 14px;
   font-family: 'Montserrat', sans-serif;
}

/* Iconos junto al label */
.resultado label i {
    margin-right: 6px;
    color: #7a5bb5;
  
}

/* Campos de informaci√≥n */
.resultado input {
    width: 100%;
    border: none;
    background: #f5f5f5;
    padding: 8px 12px;
    border-radius: 8px;
    margin-top: 4px;
    font-size: 14px;
    color: #333;
   font-family: 'Montserrat', sans-serif;
}

/* Alternado (opcional) */
.resultado.alternado {
    background: linear-gradient(145deg, #533482, #f5f5ff);
}

/* Comentario destacado */
.resultado input[disabled][value*="comentario"] {
    font-style: italic;
    color: #666;
   font-family: 'Montserrat', sans-serif;
}

/* ID Cliente peque√±o y discreto */
.resultado input[disabled][value*="dni"] {
    font-size: 12px;
    color: #999;
   font-family: 'Montserrat', sans-serif;
}

/* Badge de hora */
.badge-hora {
    position: absolute;
    top: 15px;
    right: 15px;
    background: #533482;
    color: #fff;
    padding: 4px 10px;
    border-radius: 10px;
    font-size: 12px;
    font-weight: 600;
   font-family: 'Montserrat', sans-serif;
}
/* Tooltip burbuja para cr√©ditos */
.tooltip-burbuja {
  display: none;               /* inicialmente oculto */
  position: absolute;          /* relativo al contenedor */
  top: -50px;                  /* arriba del bot√≥n */
  left: 50%;                   /* centrado horizontal */
  transform: translateX(-50%);
  background-color: #533482;   /* color morado */
  color: #fff;
  padding: 8px 12px;
  border-radius: 8px;
  font-family: 'Montserrat', sans-serif;
  font-size: 14px;
  text-align: center;
  box-shadow: 0 4px 10px rgba(0,0,0,0.2);
  z-index: 1000;
  transition: opacity 0.3s ease;
  opacity: 0;                  /* invisible antes de animar */
}

/* Cuando se muestre */
.tooltip-burbuja.show {
  display: block;
  opacity: 1;
}

/* Peque√±a flecha debajo de la burbuja */
.tooltip-burbuja::after {
  content: "";
  position: absolute;
  bottom: -6px;               /* justo debajo de la burbuja */
  left: 50%;
  transform: translateX(-50%);
  border-width: 6px;
  border-style: solid;
  border-color: #533482 transparent transparent transparent;
}


  </style>

</head>
<body>

<header>
  <div class="navbar-logo">
   <img src="https://i.ibb.co/p6Ycq6XC/Turnox-logo.png" alt="Logo" />
  </div>
 <div class="navbar-action">
    <button class="btn-redireccion" onclick="window.location.href='https://turnox.netlify.app/'">
      VOLVER A TURNERO
    </button>
  </div>
    <!-- Bot√≥n hamburguesa-->
  <button class="navbar-toggle" id="navbarToggle">
    <i class="fas fa-bars"></i>
  </button>

  <!-- Men√∫ de enlaces -->
  <nav class="navbar-menu" id="navbarMenu">
    <a href="#turnos" class="nav-link">Turnos</a>
     <a href="#lista" class="nav-link">Lista Completa</a>
    
     
    <button onclick="logout()" style="background:#EDEDED; color:#999">Cerrar sesi√≥n</button>
  </nav>
  
  
 

</header>

  
<div id="loginDiv">
 
  
  <div class="container">
    <p>Ingres√° usuario y clave para continuar:</p>
    <input type="text" id="usuario" placeholder="Usuario" />
    <input type="password" id="clave" style="text-align: center;" placeholder="Clave" />
   <button id="btnLogin" onclick="login()">Ingresar</button>

    <div id="cargandoLogin" style="text-align: center; display: none;">
    <i class="fas fa-spinner fa-spin"></i> Validando Usuario...
  </div> 
    <p id="errorLogin" style="color:red; display:none;">Usuario o clave incorrecta</p>
  </div>
</div>


<div id="appDiv" style="text-align: center; display:none;">
  <!-- APP PRINCIPAL -->
<div id="mensajeBienvenida" class="mensaje-bienvenida" style="display:none;"></div>
  <div class="container">
<div class="creditos-container">
  

  <!-- Bot√≥n con SVG -->
  <button id="creditosBtn" class="creditos-btn" title="Ver cr√©ditos">
    <!-- SVG aqu√≠ -->
    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" aria-hidden="true">
      <path fill="currentColor" fill-rule="evenodd" d="M17.47 8.893C18.886 8.185 19 7.577 19 7.5s-.114-.685-1.53-1.393C16.173 5.459 14.242 5 12 5s-4.173.459-5.47 1.107C5.114 6.815 5 7.423 5 7.5s.114.685 1.53 1.393C7.827 9.541 9.758 10 12 10s4.173-.459 5.47-1.107M21 7.5c0 2.485-4.03 4.5-9 4.5S3 9.985 3 7.5 7.03 3 12 3s9 2.015 9 4.5m-17 4a1 1 0 0 1 1 1c0 .137.053.327.262.573.389.457 1.196.953 2.42 1.331 1.196.37 2.686.596 4.318.596s3.123-.226 4.319-.596c1.223-.378 2.03-.874 2.42-1.331.208-.246.261-.436.261-.573a1 1 0 1 1 2 0c0 .721-.3 1.354-.738 1.869-.743.873-1.967 1.517-3.352 1.946-1.412.437-3.105.685-4.91.685s-3.498-.248-4.91-.685c-1.385-.429-2.609-1.073-3.352-1.946C3.301 13.854 3 13.22 3 12.5a1 1 0 0 1 1-1M5 17a1 1 0 1 0-2 0c0 .721.3 1.354.738 1.869.743.873 1.967 1.517 3.352 1.946 1.412.437 3.105.685 4.91.685s3.498-.248 4.91-.685c1.385-.429 2.609-1.073 3.352-1.946.437-.515.738-1.148.738-1.869a1 1 0 1 0-2 0c0 .137-.053.327-.262.573-.389.457-1.196.953-2.42 1.331-1.196.37-2.686.596-4.318.596s-3.122-.226-4.319-.596c-1.223-.378-2.03-.874-2.42-1.331C5.054 17.327 5 17.137 5 17" clip-rule="evenodd"></path>
    </svg>
     <!-- Burbuja -->
  <div id="creditosTooltip" class="tooltip-burbuja">
    üí° Hace clic aqu√≠ para ver los precios y agregar cr√©ditos
  </div>
<!--Cr√©ditos ocultos (por si necesitas mostrar en otro lado)-->
<div id="creditosDiv" style="display:none;">
  <h3><span id="creditosActuales">Cargando...</span></h3>
</div>
  </button>

  <!-- Burbuja -->
  <div id="tooltip" class="tooltip">
    <div id="tooltipText">Cargando...</div>
<p style="font-size: 16px; text-align: center; margin: 2px 0;">PRECIOS</p>
     <p style="font-size: 12px; text-align: center; margin: 2px 0;">1 cr√©dito = 1 Turno</p>
<p style="font-size: 14px; text-align: center; margin: 2px 0;">1 a 20 $170</p>
<p style="font-size: 14px; text-align: center; margin: 2px 0;">21 a 50 $165</p>
<p style="font-size: 14px; text-align: center; margin: 2px 0;">51 a 100 $150</p>
<p style="font-size: 14px; text-align: center; margin: 2px 0;">101 a 200 $125</p>
<p style="font-size: 14px; text-align: center; margin: 2px 0;">501 en adelante $90</p>

<button id="agregarCreditosBtn">Agregar cr√©ditos</button>
  </div>
</div>
   <!-- BUSQUEDA GENERAL 
<div class="busqueda-container">   
  <p style="font-size: 14px; text-align: center;">
    Para acceder a la Ficha M√©dica necesitas el ID, si no lo ten√©s, busc√° por Nombre primero.
  </p>

  <input type="text" id="inputBusquedaGeneral" style="text-align: center;" placeholder="Ej: Fido o ABC123 para Ficha M√©dica" />

  <div class="botones-busqueda">
    <button onclick="buscarGeneral()" style="text-align: center;">
      <i class="fas fa-search"></i> Nombre
    </button>
    <button onclick="verHistorial()" style="text-align: center;">
      <i class="fas fa-clock-rotate-left"></i> Ficha M√©dica
    </button>
  </div>
</div>

<div id="cargando" style="text-align: center;">
  <i class="fas fa-spinner fa-spin"></i> Cargando, por favor esper√°...
</div>

<div id="resultadoGeneral"></div>-->

    <!-- NUEVO: BUSCADOR POR FECHA -->
    <section id="turnos">
  <div id="busquedaFecha" style="text-align:center;">
    <label for="fechaTurno"><strong>TURNOS:</strong></label>

    <!-- Contenedor para el calendario inline -->
    <div id="fechaTurno"></div>

    <div id="cargandoFecha" style="display:none; margin-top:8px; color:#666;">Buscando turnos...</div>
    <div id="resultadoFecha" style="margin-top: 15px;"></div>
  </div>
</section>


     <section id="lista"> 
<!-- Contenedor para bot√≥n Mostrar IDs con spinner propio -->
<div style="text-align:center; margin: 20px 0;">
  <button id="btnMostrarIds" style="padding: 10px 20px; font-size: 16px; cursor: pointer;">
    Mostrar Lista Completa
  </button>
  <div id="cargandoIds" style="display:none; margin-top: 10px;">
    <i class="fas fa-spinner fa-spin"></i> Cargando, por favor esper√°...
  </div>
</div>
     <!-- Aqu√≠ mostrar√°s los resultados √∫nicos -->

     <div id="resultadoIds"></div>
  </section>

  </div>
</div>
  




   
<!-- MODAL NUEVO CAMPO -->
<div id="modalCampo">
  <h4>Agregar nuevo campo</h4>
  
  <label for="tipoCampo">Tipo de campo:</label>
  <select id="tipoCampo">
    <option value="texto">Texto corto</option>
    <option value="textarea">Texto largo</option>
    <option value="fecha">Fecha (dd/mm/aaaa)</option>
    <option value="opciones">M√∫ltiples opciones</option>
  </select>

  <div id="opcionesExtra" style="display:none; margin-top:8px;">
    <label for="listaOpciones">Opciones (separadas por coma):</label>
    <input type="text" id="listaOpciones" placeholder="Ej: Vacuna, Desparasitante, Otro" />
  </div>

  <label for="nombreCampo">Nombre del campo:</label>
  <input type="text" id="nombreCampo" placeholder="Ej: Vacuna aplicada" />

  <div style="margin-top:10px; text-align:right;">
    <button onclick="confirmarNuevoCampo()">Agregar</button>
    <button onclick="cerrarModalCampo()" style="background:#EDEDED;">Cancelar</button>
  </div>
</div>

<script>
const urlScript = "https://script.google.com/macros/s/AKfycbynvfWxVLQKACZp5mAaXeE-QXEd-BjTmucmH8zuDU-3rdWKf1wmNNgcJrEm2x8Q3r19/exec";

// ---------------------- SESI√ìN Y LOGIN ----------------------
function mostrarApp(show) {
  document.getElementById("loginDiv").style.display = show ? "none" : "block";
  document.getElementById("appDiv").style.display = show ? "block" : "none";
  document.getElementById("creditosDiv").style.display = show ? "block" : "none";

  const toggleBtn = document.getElementById("navbarToggle");
  if (toggleBtn) toggleBtn.style.display = show ? "block" : "none";

  const menu = document.getElementById("navbarMenu");
  if (menu) menu.style.display = show ? "block" : "none";

  if (!show) document.getElementById("resultadoGeneral").innerHTML = "";
}

function mostrarMensajeBienvenida(usuario) {
  const contenedor = document.getElementById("mensajeBienvenida");
  contenedor.textContent = `¬°Hola, ${usuario}!`;
  contenedor.style.display = "block";
}

function login() {
  const usuario = document.getElementById("usuario").value.trim();
  const clave = document.getElementById("clave").value.trim();
  const btnLogin = document.getElementById("btnLogin");
  const cargando = document.getElementById("cargandoLogin");

  btnLogin.style.display = "none";
  cargando.style.display = "block";
  document.getElementById("errorLogin").style.display = "none";

  fetch(urlScript, {
    method: "POST",
    headers: { "Content-Type": "application/x-www-form-urlencoded" },
    body: `accion=login&usuario=${encodeURIComponent(usuario)}&clave=${encodeURIComponent(clave)}`
  })
  .then(res => res.json())
  .then(data => {
    if (data.success) {
      sessionStorage.setItem("logueado", "true");
      sessionStorage.setItem("usuario", usuario);
      document.body.classList.add("logueado");
      mostrarApp(true);
      mostrarMensajeBienvenida(usuario);

      // Aviso WhatsApp
      let phone = "5493434477577";
      let apikey = "9663015";
      let mensaje = encodeURIComponent(`üîî Nuevo ingreso al sistema: ${usuario}`);
      fetch(`https://api.callmebot.com/whatsapp.php?phone=${phone}&text=${mensaje}&apikey=${apikey}`)
        .catch(err => console.error("Error enviando WhatsApp", err));

      // Flatpickr y turnos
      const hoy = new Date().toISOString().split("T")[0];
      if (document.getElementById("fechaTurno")._flatpickr) {
        document.getElementById("fechaTurno")._flatpickr.setDate(hoy);
      }
      buscarPorFecha();
    } else {
      const errorDiv = document.getElementById("errorLogin");
      errorDiv.style.display = "block";
      errorDiv.textContent = data.error || "Usuario o clave incorrecta";
    }
  })
  .catch(err => {
    console.error(err);
    const errorDiv = document.getElementById("errorLogin");
    errorDiv.style.display = "block";
    errorDiv.textContent = "Error en la conexi√≥n";
  })
  .finally(() => {
    cargando.style.display = "none";
    btnLogin.style.display = "inline-block";
  });
}

function logout() {
  sessionStorage.removeItem("logueado");
  document.body.classList.remove("logueado");
  mostrarApp(false);

  // Cerrar men√∫ hamburguesa
  const menu = document.getElementById('navbarMenu');
  const toggleBtn = document.getElementById('navbarToggle');
  menu.classList.remove('active');
  toggleBtn.classList.remove('active');
}

// ---------------------- B√öSQUEDA GENERAL / HISTORIAL ----------------------
function buscarGeneral() {
  const query = document.getElementById("inputBusquedaGeneral").value.trim().toLowerCase();
  if (!query) return alert("Ingres√° un dato para buscar.");
  ejecutarBusqueda("?buscar=" + encodeURIComponent(query), "Resultados encontrados:");
}

function verHistorial() {
  const dni = document.getElementById("inputBusquedaGeneral").value.trim().toUpperCase();
  if (!dni) return alert("Ingres√° un ID v√°lido.");
  ejecutarBusqueda("?historial=" + dni, `Ficha M√©dica ID: ${dni}`);
}

function ejecutarBusqueda(parametro, titulo) {
  const resultadoDiv = document.getElementById("resultadoGeneral");
  const cargando = document.getElementById("cargando");
  resultadoDiv.innerHTML = "";
  cargando.style.display = "block";

  fetch(urlScript + parametro)
    .then(res => res.json())
    .then(data => {
      cargando.style.display = "none";
      if (data.success && data.resultados.length > 0) {
        const esBusquedaGeneral = parametro.startsWith("?buscar=");
        mostrarResultados(data.resultados, titulo, esBusquedaGeneral);
      } else {
        resultadoDiv.innerHTML = "<p style='color:#533482;'>No se encontraron datos.</p>";
      }
    })
    .catch(() => {
      cargando.style.display = "none";
      alert("Error al buscar en la base de datos.");
    });
}

function mostrarResultados(lista, titulo, esBusquedaGeneral = false) {
  const resultadoDiv = document.getElementById("resultadoGeneral");
  let html = `<h3>${titulo}</h3>`;

  lista.forEach((r, index) => {
    const claseFondo = index % 2 === 0 ? "" : "alternado";
    if (esBusquedaGeneral) {
      html += `
        <div class="resultado ${claseFondo}" id="registro-${index}">
          <label>Nombre Comercio:</label>
          <input type="text" value="${r.nombre}" disabled>
          <label>Nombre y Apellido:</label>
          <input type="text" value="${r.nombreMascota}" disabled>
          <label>ID Cliente:</label>
          <input type="text" value="${r.dniMascota}" disabled>
        </div>`;
    } else {
      html += `
        <div class="resultado ${claseFondo}" id="registro-${index}">
          <label>Paciente desde:</label><input type="text" value="${r.fecha}" disabled>
          <label>ID Mascota:</label><input type="text" id="dni-${index}" value="${r.dniMascota}" disabled>
          <label>Nombre Humano:</label><input type="text" id="nombre-${index}" value="${r.nombre}" disabled>
          <label>Nombre Mascota:</label><input type="text" id="mascota-${index}" value="${r.nombreMascota}" disabled>
          <label>Especie:</label><input type="text" id="tipo-${index}" value="${r.tipoMascota}" disabled>
          <label>Email:</label><input type="email" id="email-${index}" value="${r.email}" disabled>
          <label>Tel√©fono:</label><input type="text" id="tel-${index}" value="${r.telefono}" disabled>
          <label>Fecha de Nac:</label><input type="text" id="fehcaDeNac-${index}" value="${r.fehcaDeNac ? new Date(r.fehcaDeNac).toLocaleDateString('es-AR') : ''}" disabled>
          <label>Peso:</label><input type="text" id="peso-${index}" value="${r.peso || ''}" disabled>
          <label>Veterinario que lo atiende:</label><textarea id="historial-${index}" disabled>${r.veterinario || ''}</textarea>
          <label>Pr√≥xima vacuna:</label><input type="text" id="proximaVacuna-${index}" value="${r.proxima_vacuna ? new Date(r.proxima_vacuna).toLocaleDateString('es-AR') : ''}" disabled>
          <div id="extraCampos-${index}"></div>
          <button type="button" onclick="agregarBloqueCampos(${index})"><i class="fas fa-plus"></i> Agregar Datos M√©dicos</button>
          <button id="btnEditar-${index}" onclick="habilitarEdicion(${index})"><i class="fas fa-edit"></i> Editar</button>
        </div>`;
    }
  });

  resultadoDiv.innerHTML = html;

  // Renderizar extras
  if (!esBusquedaGeneral) {
    lista.forEach((r, index) => {
      renderizarBloquesExtras(index, r.extras);
    });
  }
}

// ---------------------- EDICI√ìN / GUARDAR ----------------------
function habilitarEdicion(index) {
  const campos = [`nombre-${index}`, `mascota-${index}`, `tipo-${index}`, `email-${index}`, `tel-${index}`,
    `fehcaDeNac-${index}`, `peso-${index}`, `historial-${index}`, `proximaVacuna-${index}`];
  campos.forEach(id => document.getElementById(id).disabled = false);

  // Convertir fechas a type="date"
  const fechaCampos = [`fehcaDeNac-${index}`, `proximaVacuna-${index}`];
  fechaCampos.forEach(id => {
    const input = document.getElementById(id);
    if (input && input.value) {
      const partes = input.value.split("/");
      if (partes.length === 3) input.value = `${partes[2]}-${partes[1].padStart(2,'0')}-${partes[0].padStart(2,'0')}`;
    }
    if(input) input.type="date";
  });

  // Bloques extras
  const contenedorExtras = document.getElementById(`extraCampos-${index}`);
  contenedorExtras?.querySelectorAll('input, select, textarea').forEach(c => c.disabled = false);

  const btn = document.getElementById(`btnEditar-${index}`);
  if (btn) {
    btn.innerHTML = '<i class="fas fa-save"></i> Guardar';
    btn.onclick = () => guardarCambios(index);
  }
}

function guardarCambios(index) {
  const datosActualizados = {
    dniMascota: document.getElementById(`dni-${index}`).value.trim(),
    nombre: document.getElementById(`nombre-${index}`).value.trim(),
    nombreMascota: document.getElementById(`mascota-${index}`).value.trim(),
    tipoMascota: document.getElementById(`tipo-${index}`).value.trim(),
    email: document.getElementById(`email-${index}`).value.trim(),
    telefono: document.getElementById(`tel-${index}`).value.trim(),
    fehcaDeNac: document.getElementById(`fehcaDeNac-${index}`).value.trim(),
    peso: document.getElementById(`peso-${index}`).value.trim(),
    veterinario: document.getElementById(`historial-${index}`).value.trim(),
    proxima_vacuna: document.getElementById(`proximaVacuna-${index}`).value.trim(),
    extras: {}
  };

  const contenedorExtras = document.getElementById(`extraCampos-${index}`);
  if (contenedorExtras) {
    const bloques = contenedorExtras.getElementsByClassName("bloque-campos");
    for (let i=0; i<bloques.length; i++) {
      const bloque = bloques[i];
      const fecha = bloque.querySelector('input[type="date"]')?.value || "";
      const selectMotivo = bloque.querySelector('select[multiple]');
      const motivos = selectMotivo ? Array.from(selectMotivo.selectedOptions).map(o=>o.value).join(", ") : "";
      const descripcion = bloque.querySelector('textarea')?.value || "";
      const observaciones = bloque.querySelector('textarea')?.value || "";
      datosActualizados.extras[`Fecha_${i+1}`] = fecha;
      datosActualizados.extras[`Motivo_${i+1}`] = motivos;
      datosActualizados.extras[`Descripci√≥n_${i+1}`] = descripcion;
      datosActualizados.extras[`Observaciones_${i+1}`] = observaciones;
    }
  }

  fetch(urlScript, {
    method: "POST",
    body: new URLSearchParams({
      accion: "editar",
      datos: JSON.stringify(datosActualizados)
    })
  })
  .then(res=>res.json())
  .then(resp => {
    if (resp.success) { alert("Cambios guardados correctamente."); buscarGeneral(); }
    else alert("Error: " + resp.error);
  })
  .catch(()=>alert("Error de conexi√≥n al guardar los cambios."));
}

// ---------------------- BLOQUES EXTRAS ----------------------
function renderizarBloquesExtras(index, extras) {
  const contenedor = document.getElementById(`extraCampos-${index}`);
  if (!contenedor) return;
  contenedor.innerHTML = "";
  if (!extras) return;

  const bloques = {};
  Object.entries(extras).forEach(([clave, valor]) => {
    const [campo, num] = clave.split("_");
    if (!bloques[num]) bloques[num]={};
    bloques[num][campo]=valor;
  });

  Object.entries(bloques).forEach(([num, bloque])=>{
    const tieneDatos = Object.values(bloque).some(v=>v&&v.trim()!=="");
    if(tieneDatos) crearBloqueConDatos(contenedor,bloque);
  });
}

function crearBloqueConDatos(contenedor, bloque) {
  const div = document.createElement("div");
  div.className="bloque-campos"; div.style.borderTop="3px dotted #000"; div.style.marginTop="10px"; div.style.paddingTop="10px";

  const crearCampo = (labelTxt, tipo, valor, multiple=false, opciones=[])=>{
    const lbl = document.createElement("label"); lbl.textContent=labelTxt;
    let input;
    if(tipo==="select"){
      input = document.createElement("select"); input.multiple=multiple; input.disabled=true;
      opciones.forEach(op=>{
        const opt = document.createElement("option"); opt.value=op; opt.textContent=op;
        if(bloque.Motivo?.split(",").map(s=>s.trim()).includes(op)) opt.selected=true;
        input.appendChild(opt);
      });
    } else if(tipo==="textarea"){ input=document.createElement("textarea"); input.value=valor||""; input.disabled=true; }
    else { input=document.createElement("input"); input.type=tipo; input.value=valor||""; input.disabled=true; }
    div.appendChild(lbl); div.appendChild(input);
  };

  crearCampo("Fecha","date",bloque.Fecha);
  crearCampo("Motivo","select","",true,["Consulta","Vacuna","Antiparasitario","Tratamiento","Cirug√≠a","Otro"]);
  crearCampo("Descripci√≥n","textarea",bloque.Descripci√≥n);
  crearCampo("Observaciones","textarea",bloque.Observaciones);

  contenedor.appendChild(div);
}

function agregarBloqueCampos(index){
  const container=document.getElementById(`extraCampos-${index}`);
  const bloque=document.createElement("div"); bloque.className="bloque-campos";
  bloque.style.borderTop="1px dotted #EDEDED"; bloque.style.marginTop="10px"; bloque.style.paddingTop="10px";

  const crearInput=(labelTxt,tipo,multiple=false,opciones=[])=>{
    const lbl=document.createElement("label"); lbl.textContent=labelTxt;
    let input;
    if(tipo==="select"){
      input=document.createElement("select"); input.multiple=multiple; input.disabled=true;
      opciones.forEach(op=>{ const opt=document.createElement("option"); opt.value=op; opt.textContent=op; input.appendChild(opt); });
    } else if(tipo==="textarea") input=document.createElement("textarea"); 
    else { input=document.createElement("input"); input.type=tipo; if(tipo==="date") input.valueAsDate=new Date(); input.disabled=true; }
    bloque.appendChild(lbl); bloque.appendChild(input);
  };

  crearInput("Fecha","date");
  crearInput("Motivo","select",true,["Consulta","Vacuna","Antiparasitario","Tratamiento","Cirug√≠a"]);
  crearInput("Descripci√≥n","textarea");
  crearInput("Observaciones","textarea");

  container.appendChild(bloque);
}

// ---------------------- B√öSQUEDA POR FECHA Y TURNOS ----------------------
function formatearHora(hora){
  if(!hora) return "";
  let fechaObj;
  if(typeof hora==="string" && hora.includes("T")) fechaObj=new Date(hora);
  else if(typeof hora==="string" && hora.includes(":")){ const [h,m]=hora.split(":"); fechaObj=new Date(); fechaObj.setHours(parseInt(h),parseInt(m),0,0); }
  else if(hora instanceof Date||typeof hora==="number") fechaObj=new Date(hora);
  if(!fechaObj) return hora;
  fechaObj.setMinutes(fechaObj.getMinutes()-75);
  return fechaObj.toLocaleTimeString("es-AR",{hour:"2-digit",minute:"2-digit",hour12:false});
}

function buscarPorFecha(){
  const fecha=document.getElementById("fechaTurno").value;
  const resultadoFecha=document.getElementById("resultadoFecha");
  const cargandoFecha=document.getElementById("cargandoFecha");

  if(!fecha){ alert("Por favor, seleccion√° una fecha."); return; }

  resultadoFecha.innerHTML="";
  cargandoFecha.style.display="block";

  fetch(urlScript+"?fecha="+encodeURIComponent(fecha))
    .then(res=>res.text())
    .then(text=>{
      cargandoFecha.style.display="none";
      let data;
      try{ data=JSON.parse(text); }catch(e){ alert("Respuesta inv√°lida"); return; }

      if(data.success && data.resultados.length>0){
        let [anio,mes,dia]=fecha.split("-");
        let fechaFormateada=`${dia}/${mes}/${anio}`;
        let html=`<h3>Turnos para el d√≠a ${fechaFormateada}</h3>`;
        data.resultados.forEach((t,i)=>{
          html+=`<div class="resultado ${i%2===0?'':'alternado'}">
          <div class="badge-hora">${formatearHora(t.turno)}</div>
          <div class="logo-container"><img src="https://i.ibb.co/p6Ycq6XC/Turnox-logo.png" alt="Logo" class="logo-turno"></div>
          <label>Comercio</label><input type="text" value="${t.nombre}" disabled>
          <label>Nombre</label><input type="text" value="${t.nombreMascota}" disabled>
          <label>Direcci√≥n</label><input type="text" value="${t.tipoMascota}" disabled>
          <label>Email</label><input type="text" value="${t.email}" disabled>
          <label>Tel√©fono</label><input type="text" value="${t.telefono}" disabled>
          <label>Comentario</label><input type="text" value="${t.comentario}" disabled>
          <label>ID Cliente</label><input type="text" value="${t.dniMascota}" disabled>
          </div>`;
        });
        resultadoFecha.innerHTML=html;
      }else resultadoFecha.innerHTML=`<p style="color:#533482;">No hay turnos para este d√≠a</p>`;
    })
    .catch(err=>{ cargandoFecha.style.display="none"; alert("Error al buscar turnos"); });
}

// ---------------------- BURBUJA CR√âDITOS ----------------------
document.addEventListener("DOMContentLoaded", ()=>{
  const creditosSpan=document.getElementById("creditosActuales");
  const btnCreditos=document.getElementById("creditosBtn");
  const tooltip=document.getElementById("tooltip");
  const tooltipText=document.getElementById("tooltipText");
  const btnAgregar=document.getElementById("agregarCreditosBtn");

  function cargarCreditos(){
    fetch(urlScript+"?accion=creditos")
      .then(r=>r.json())
      .then(d=>creditosSpan.textContent=d.success?d.creditos:"Error")
      .catch(()=>creditosSpan.textContent="Error");
  }

  cargarCreditos();

  btnCreditos.addEventListener("click", e=>{
    e.stopPropagation();
    tooltipText.innerHTML=`Cr√©ditos disponibles: <b>${creditosSpan.textContent}</b>`;
    tooltip.classList.toggle("visible");
    localStorage.setItem("tooltipMostrado","true");
  });

  document.addEventListener("click", e=>{
    if(!btnCreditos.contains(e.target) && !tooltip.contains(e.target)) tooltip.classList.remove("visible");
  });

  btnAgregar.addEventListener("click", ()=>{
    const usuario=sessionStorage.getItem("usuario")||"Usuario";
    const numero="5493434477577";
    const mensaje=encodeURIComponent(`Hola, soy ${usuario} y quiero agregar cr√©ditos.`);
    window.open(`https://wa.me/${numero}?text=${mensaje}`,"_blank");
  });

  // Mostrar tooltip al cargar si no se mostr√≥ antes
  const creditosTooltip=document.getElementById("creditosTooltip");
  if(creditosTooltip && !localStorage.getItem("tooltipMostrado")){
    setTimeout(()=>creditosTooltip.classList.add("show"),2000);
  }
});

// ---------------------- MEN√ö HAMBURGUESA ----------------------
document.addEventListener("DOMContentLoaded", ()=>{
  const toggleBtn=document.getElementById('navbarToggle');
  const menu=document.getElementById('navbarMenu');

  toggleBtn.addEventListener('click',()=>{
    menu.classList.toggle('active');
    toggleBtn.classList.toggle('active');
  });

  document.querySelectorAll('.navbar-menu .nav-link').forEach(link=>{
    link.addEventListener('click',()=>{
      menu.classList.remove('active');
      toggleBtn.classList.remove('active');
    });
  });
});

// ---------------------- FLATPICKR ----------------------
document.addEventListener("DOMContentLoaded", ()=>{
  flatpickr("#fechaTurno", {
    inline:true,
    dateFormat:"Y-m-d",
    locale:"es",
    defaultDate:"today",
    onChange:(selectedDates,dateStr)=>buscarPorFecha()
  });
});
</script>

</body>
    
</html>
